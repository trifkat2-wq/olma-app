<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Olma Market — Поиск менеджера</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        /* ... старые стили ... */
        :root{
            --olma-red: rgb(239,62,45);
            --olma-green: rgb(77,185,109);
            --olma-yellow: rgb(255,198,62);
            --olma-black: #202020;
            --card-w: 520px;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            font-family: Arial, Helvetica, sans-serif;
            background:#f3f4f6;
            display:flex;
            align-items:center;
            justify-content:center;
            min-height:100vh;
            padding: 16px 0;
        }
        .card{
            width: min(var(--card-w), 96vw);
            background:#fff;
            border-radius:16px;
            box-shadow:0 8px 24px rgba(0,0,0,.12);
            padding:22px 24px 18px;
            text-align:center;
            /* position:relative; <-- ИСПРАВЛЕНИЕ 4: Удалено для исправления наложения */
        }
        .logo{ width:180px; margin:2px auto 10px; display:block; object-fit:contain; }
        h1, h2{ margin:4px 0 14px; color:var(--olma-black); }
        h1 { font-size:28px; }
        h2 { font-size:22px; }
        textarea, select, input[type="password"] {
            display:block; width:100%;
            padding:10px 12px; border:1.5px solid #d1d5db; border-radius:10px;
            font-family: ui-monospace, monospace; font-size:14px; line-height:1.4;
            resize:vertical; margin:0 auto 14px;
        }
        textarea{ height:120px; }
        .btn{
            display:block; width:100%; border:none; border-radius:12px;
            padding:12px 16px; font-size:16px; font-weight:700;
            cursor:pointer; transition:transform .02s ease, opacity .2s ease;
            color:#fff; margin:10px auto 0;
        }
        .btn:active{ transform:scale(.995); }
        .btn[disabled] { background-color: #9ca3af; cursor: not-allowed; }
        .btn-red{ background:var(--olma-red); }
        .btn-green{ background:var(--olma-green); }
        .btn-yellow{ background:var(--olma-yellow); color:#212121; }
        .results{ text-align:left; margin-top:14px; }
        .mgr{ font-weight:700; color:var(--olma-black); margin:14px 0 6px }
        ol{ margin:6px 0 0 18px; padding-left: 18px; }
        .muted{ color:#6b7280; font-style:italic; margin-top:8px }
        .copy-wrap{ display:none; margin-top:12px; text-align:center; }
        .copy-btn{ width:28px; height:28px; border:none; background:transparent; cursor:pointer; opacity:.75; padding:0; margin:0 auto; }
        .copy-btn:hover{ opacity:1 } .copy-btn:active{ transform:scale(.98) }
        .copy-btn svg{ width:100%; height:100%; display:block; }
        
        /* ИСПРАВЛЕНИЕ 4: Изменена стилизация кнопок, чтобы они не накладывались на заголовок */
        .upbar{ 
            display: flex; 
            gap: 10px; 
            justify-content: flex-end;
            margin-bottom: 12px;
        }
        .btn-journal{
            background:#fff; border:none; border-radius:8px; padding:6px 12px;
            font-weight:600; font-size:14px; cursor:pointer;
            box-shadow:0 2px 6px rgba(0,0,0,.15);
            line-height: 1.2;
        }
        .btn-journal:hover{ background:#f9f9f9; }
        
        .overlay{
            position:fixed; top:0; left:0; right:0; bottom:0;
            background:rgba(0,0,0,0.4);
            display:flex; align-items:center; justify-content:center;
            z-index:1000;
        }

        /* ИСПРАВЛЕНИЕ 1: Увеличен z-index для окон подтверждения и пароля */
        .password-overlay, .confirm-overlay {
            z-index: 1100;
        }
        
        .journal-overlay, .filter-overlay, .training-overlay, .guest-overlay, .upload-training-overlay { display:none; }

        .journal-window{
            width:90vw; height:80vh;
            background:#fff; border-radius:14px;
            box-shadow:0 8px 24px rgba(0,0,0,.25);
            display:flex; flex-direction:column; overflow:hidden;
        }
        .journal-header{
            flex:0 0 auto; padding:12px 16px; background:#f3f4f6;
            border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center;
        }
        .journal-header h2{ margin:0; font-size:18px; font-weight:700; }
        .journal-close{ border:none; background:transparent; font-size:20px; cursor:pointer; }
        .journal-body{ flex:1 1 auto; overflow:auto; padding:12px; text-align:left; }
        table.journal-table{ border-collapse:collapse; width:100%; font-size:14px; }
        .journal-table th,.journal-table td{ border:1px solid #ddd; padding:6px 8px; text-align:left; vertical-align: top; }
        .journal-table th{ background:#f9fafb; }
        .journal-table select { border: 1px solid #ddd; border-radius: 4px; padding: 2px; }
        .journal-footer{ padding:10px; border-top:1px solid #ddd; text-align:right; display:flex; justify-content:space-between; }
        .btn-export-journal, .btn-clear-journal{
            background:var(--olma-green); color:#fff; border:none;
            padding:8px 14px; border-radius:8px; font-weight:600; cursor:pointer;
        }
        .btn-clear-journal{ background:var(--olma-red); }
        
        details.date-group { border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; }
        details.date-group summary {
            font-weight: 700; font-size: 16px; padding: 10px 14px; cursor: pointer;
            background-color: #f9fafb;
        }
        details[open].date-group summary { border-bottom: 1px solid #e5e7eb; }
        .date-content { padding: 8px; }

        .modal-window .form-group{ text-align: left; margin-bottom: 12px; }
        .modal-window .form-group label{ font-weight: 600; font-size: 14px; margin-bottom: 4px; display: block; }
        .modal-window p { margin: 10px 0 20px; }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }

        .toast {
            position: fixed; top: 20px; left: 50%;
            transform: translateX(-50%);
            background-color: var(--olma-green); color: white;
            padding: 12px 20px; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 2000; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, top 0.3s ease, visibility 0.3s ease;
        }
        .toast.show { opacity: 1; visibility: visible; top: 40px; }
        .toast.error { background-color: var(--olma-red); }

        @media (max-width: 520px) {
            .card { padding: 20px 16px 16px; }
            h1 { font-size: 24px; margin-bottom: 12px; }
            .btn { padding: 11px 14px; font-size: 15px; margin-top: 8px; }
            textarea { height: 100px; font-size: 13px; }
            .logo { width: 150px; }
            .journal-window { width: 95vw; height: 85vh; }
        }
    </style>
</head>
<body>
    <div id="welcomeOverlay" class="overlay">
        <div class="card welcome-card">
            <img class="logo" src="logo_olma_hd_transparent.png" alt="Olma Market" onerror="this.style.display='none'">
            <h1>Привет!</h1>
            <p>Выберите свое ФИО, чтобы начать работу.</p>
            <select id="userSelect">
                <option value="" disabled selected>Выберите пользователя</option>
                <option value="Тимаев Рифкат">Тимаев Рифкат</option>
                <option value="Гуламова Сабина">Гуламова Сабина</option>
                <option value="Турсунова Умида">Турсунова Умида</option>
                <option value="Дониер Алибаев">Дониер Алибаев</option>
                <option value="Наталия Юсупова">Наталия Юсупова</option>
                <option value="Шахноза Рахманкулова">Шахноза Рахманкулова</option>
            </select>
            <button class="btn btn-red" id="btnStart">Начать</button>
        </div>
    </div>

    <div id="mainApp" style="display:none;">
        <div class="card">
            <div class="upbar">
                <button class="btn-journal" id="btnGuests">Гости</button>
                <button class="btn-journal" id="btnTraining">Тренинг</button>
                <button class="btn-journal" id="btnJournal">Журнал</button>
            </div>
            <img class="logo" src="logo_olma_hd_transparent.png" alt="Olma Market" onerror="this.style.display='none'">
            <h1>Поиск менеджера</h1>
            <textarea id="input" placeholder="Введите текст"></textarea>
            <button class="btn btn-red" id="btnSearch">Показать менеджера</button>
            <button class="btn btn-green" id="btnExport">Экспорт поиска в Excel</button>
            <input type="file" id="fileInput" accept=".xlsx,.xls" hidden>
            <button class="btn btn-yellow" id="btnImport">Импорт базы из Excel</button>
            <div id="results" class="results"></div>
            <div id="copyWrap" class="copy-wrap">
                <button id="btnCopy" class="copy-btn"><svg viewBox="0 0 24 24"><path d="M16 2h-1.18A3 3 0 0 0 12 0a3 3 0 0 0-2.82 2H8a2 2 0 0 0-2 2v2h12V4a2 2 0 0 0-2-2zM6 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8H6z"/></svg></button>
            </div>
            <div id="emptyMsg" class="muted"></div>
            <div id="dbStatus" class="muted" style="font-size: 12px; margin-top: 5px; font-weight: bold;"></div>
        </div>
    </div>
    
    <div id="journalOverlay" class="journal-overlay overlay">
        </div>
    
    <div id="filterOverlay" class="filter-overlay overlay">
        </div>

    <div id="passwordOverlay" class="password-overlay overlay">
        </div>

    <div id="confirmOverlay" class="confirm-overlay overlay">
        </div>

    <div id="trainingOverlay" class="training-overlay overlay">
        <div class="journal-window" style="width: min(600px, 90vw); height: 70vh;">
            <div class="journal-header">
                <h2>Список на тренинг</h2>
                <button class="journal-close" id="closeTraining">×</button>
            </div>
            <div class="journal-body">
                <h3 id="trainingStatus" style="text-align: center; margin-bottom: 15px;">Загрузка...</h3>
                <ol id="trainingListContainer"></ol>
            </div>
            <div class="journal-footer">
                <button class="btn-clear-journal" id="btnClearTrainingList">Очистить список</button>
                <button class="btn-export-journal" id="btnUploadTrainingList">Загрузить новый список</button>
            </div>
        </div>
    </div>
    <div id="guestOverlay" class="guest-overlay overlay">
        <div class="journal-window" style="width: min(700px, 90vw); height: 70vh;">
            <div class="journal-header">
                <h2>Журнал Гостей</h2>
                <button class="journal-close" id="closeGuests">×</button>
            </div>
            <div class="journal-body" id="guestListContainer"></div>
            <div class="journal-footer">
                <button class="btn-clear-journal" id="btnClearGuests">Очистить журнал гостей</button>
                <button class="btn-export-journal" id="btnExportGuests">Экспорт в Excel</button>
            </div>
        </div>
    </div>
    <div id="uploadTrainingOverlay" class="upload-training-overlay overlay">
        <div class="card modal-window" style="width: min(500px, 90vw);">
            <h2>Загрузка списка на тренинг</h2>
            <p>Вставьте сюда ФИО сотрудников. Каждый сотрудник с новой строки.</p>
            <textarea id="trainingListInput" placeholder="Иванов Иван&#10;Петров Петр" style="height: 200px; font-size: 13px;"></textarea>
            <div class="modal-buttons">
                <button class="btn" id="btnCancelUpload" style="background-color: #6b7280;">Отмена</button>
                <button class="btn btn-green" id="btnSaveTrainingList">Сохранить</button>
            </div>
        </div>
    </div>


    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>


<script>
    // ... Firebase config без изменений ...
    const firebaseConfig = {
      apiKey: "AIzaSyDHrpashKVWzfqRWwp2fmrhfkvVNYEcMFI",
      authDomain: "olma-market-db.firebaseapp.com",
      projectId: "olma-market-db",
      storageBucket: "olma-market-db.appspot.com",
      messagingSenderId: "177102940053",
      appId: "1:77102940053:web:d799ea7b8c9e71b704789c"
    };

    firebase.initializeApp(firebaseConfig);
    const firestore = firebase.firestore();

    /* === Хранилище === */
    let DB = {}, currentUser = "", journal = [], displayedJournal = [], trainingList = [], guestList = [], initialTrainingListSize = 0;
    const dbStatusEl = document.getElementById('dbStatus'), importBtn = document.getElementById('btnImport');

    let toastTimeout;
    function showToast(message, isError = false) {
        // ... функция без изменений
    }

    function showConfirm(message, onConfirm) {
        // ... функция без изменений
    }

    // ИСПРАВЛЕНИЕ 3: Новая универсальная функция запроса пароля
    let passwordSuccessCallback = null;
    function requestPassword(onSuccess) {
        passwordSuccessCallback = onSuccess;
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordOverlay').style.display = 'flex';
    }
    
    document.getElementById('btnConfirmClear').addEventListener('click', () => {
        const passwordInput = document.getElementById('passwordInput');
        if (passwordInput.value === 'Trener') {
            if (passwordSuccessCallback) {
                passwordSuccessCallback();
            }
        } else {
            showToast("Неверный пароль!", true);
        }
        passwordInput.value = '';
        document.getElementById('passwordOverlay').style.display = 'none';
        passwordSuccessCallback = null;
    });
     document.getElementById('btnCancelClear').addEventListener('click', () => {
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordOverlay').style.display = 'none';
        passwordSuccessCallback = null;
    });

    // --- Функции работы с Firebase (без изменений) ---
    async function loadDB() { /*...*/ }
    async function saveDB(newDB) { /*...*/ }
    async function loadJournal(user) { /*...*/ }
    async function saveJournal(user, journalData) { /*...*/ }
    async function loadTrainingList() { /*...*/ }
    async function saveTrainingList(newList, isNewUpload = false) { /*...*/ }
    async function loadGuestList() { /*...*/ }
    async function saveGuestList(updatedGuestList) { /*...*/ }
    
    // ... Остальные функции до doSearch() без изменений ...
    function doImportFromExcel(file){ /*...*/ }
    async function addToJournal(newEntries){ /*...*/ }
    function renderJournal(journalData) { /*...*/ }
    function renderTrainingList() { /*...*/ }
    function renderGuestList() { /*...*/ }
    async function handleShiftChange(event) { /*...*/ }
    const CODE_RE = /([A-ZА-Я])\s*-?\s*0*(\d+)/ig;
    function normalizeCode(letter, numberStr) { /*...*/ }
    function buildCodeMap(db){ /*...*/ }
    let lastExport={};

    // ИСПРАВЛЕНИЕ 2: Логика doSearch полностью переписана для корректного определения гостей
    async function doSearch() {
        const ta = document.getElementById('input');
        const raw = ta.value.trim();
        const out = document.getElementById('results');
        const empty = document.getElementById('emptyMsg');
        const copyWrap = document.getElementById('copyWrap');
        out.innerHTML = ''; empty.textContent = ''; copyWrap.style.display = 'none';

        if (!raw) { empty.textContent = 'Введите данные'; return; }
        if (Object.keys(DB).length === 0) {
            empty.textContent = 'База пуста. Импортируйте файл Excel.';
            return;
        }

        const lines = raw.split(/\n/).map(s => s.trim()).filter(Boolean);
        const codeMap = buildCodeMap(DB);
        const grouped = {};
        const guests = [];
        
        const guestRegex = /\b(ТМ|РМ)\b/i;

        for (const line of lines) {
            let isGuest = false;
            let hasManager = false;

            // Сначала проверяем на гостевые маркеры
            if (guestRegex.test(line)) {
                isGuest = true;
            } else {
                // Ищем менеджера
                CODE_RE.lastIndex = 0; // Сброс индекса для глобального поиска
                let match;
                while ((match = CODE_RE.exec(line)) !== null) {
                    const normalizedCode = normalizeCode(match[1], match[2]);
                    const manager = codeMap[normalizedCode];
                    if (manager) {
                        if (!grouped[manager]) grouped[manager] = [];
                        if (!grouped[manager].includes(line)) {
                           grouped[manager].push(line);
                        }
                        hasManager = true;
                    }
                }
                // Если не нашли менеджера ни по одному коду в строке - это гость
                if (!hasManager) {
                    isGuest = true;
                }
            }
            
            if (isGuest) {
                guests.push(line);
            }
        }
        
        const now = new Date().toLocaleString('ru-RU', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });

        // Сохраняем гостей, если они есть
        if (guests.length > 0) {
            const newGuestEntries = guests.map(g => ({
                id: Date.now() + Math.random(),
                user: currentUser, text: g, date: now
            }));
            const updatedGuestList = [...guestList, ...newGuestEntries];
            await saveGuestList(updatedGuestList);
            await loadGuestList();
            showToast(`${guests.length} чел. добавлено в журнал гостей.`);
        }

        // Обрабатываем найденных сотрудников
        if (Object.keys(grouped).length === 0) {
            if (guests.length === 0) empty.textContent = 'Совпадений нет';
        } else {
            const searchId = Date.now();
            const newJournalEntries = [];
            // ... (логика отображения, журнала, минусования - без изменений) ...
             for (const [m, arr] of Object.entries(grouped)) {
                const h = document.createElement('div'); h.className = 'mgr'; h.textContent = 'Менеджер ' + m + ':'; out.appendChild(h);
                const ol = document.createElement('ol');
                arr.forEach(v => {
                    const li = document.createElement('li'); li.textContent = v; ol.appendChild(li);
                    newJournalEntries.push({
                        id: Date.now() + Math.random(),
                        user: currentUser, manager: m, employee: v, date: now,
                        shift: '1-Смена', // Будет определено позже
                        searchId: searchId
                    });
                });
                out.appendChild(ol);
            }
            const todayDate = new Date().toLocaleDateString('ru-RU');
            const todaySearches = journal.filter(e => e.date.startsWith(todayDate)).map(e => e.searchId);
            const shiftCount = new Set(todaySearches).size;
            let shift = (shiftCount === 0) ? '1-Смена' : (shiftCount === 1) ? '2-Смена' : 'Открытая смена';
            newJournalEntries.forEach(e => e.shift = shift);

            await addToJournal(newJournalEntries);
            copyWrap.style.display = 'block';

            if (trainingList.length > 0) {
                const foundEmployeesText = Object.values(grouped).flat().join('\n');
                let updatedTrainingList = [...trainingList];
                let removedCount = 0;
                
                updatedTrainingList = updatedTrainingList.filter(fio => {
                    if (foundEmployeesText.includes(fio)) {
                        removedCount++;
                        return false;
                    }
                    return true;
                });
                
                if (removedCount > 0) {
                    await saveTrainingList(updatedTrainingList);
                    showToast(`Отмечено в списке на тренинг: ${removedCount} чел.`);
                }
            }
        }
        
        lastExport = grouped;
        ta.value = "";
    }
    
    // ... Функции экспорта, копирования, и т.д. без изменений ...
    function exportSearch(){ /*...*/ }
    function exportJournal(){ /*...*/ }
    function exportGuests() { /*...*/ }
    function doCopyResults(){ /*...*/ }
    function legacyCopy(t){ /*...*/ }
    function toastCopied(){ /*...*/ }
    function populateUserFilter() { /*...*/ }
    function checkTrainingReminder() { /*...*/ }
    
    document.addEventListener("DOMContentLoaded", populateUserFilter);

    document.getElementById("btnStart").addEventListener("click", async () => {
        const userSelect = document.getElementById("userSelect");
        if (userSelect.value) {
            currentUser = userSelect.value;
            await loadDB(); 
            journal = await loadJournal(currentUser); 
            await loadTrainingList();
            await loadGuestList();
            checkTrainingReminder();
            document.getElementById("welcomeOverlay").style.display = "none";
            document.getElementById("mainApp").style.display = "block";
        } else {
            showToast("Пожалуйста, выберите ваше ФИО", true);
        }
    });

    // ... старые обработчики ...
    document.getElementById("btnCopy").addEventListener("click", doCopyResults);
    document.getElementById("btnSearch").addEventListener("click", doSearch);
    document.getElementById("btnExport").addEventListener("click", exportSearch);
    document.getElementById("btnImport").addEventListener("click", ()=>document.getElementById("fileInput").click());
    document.getElementById("fileInput").addEventListener("change", e => { const f=e.target.files[0]; if(f) doImportFromExcel(f); e.target.value=""; });
    document.getElementById("btnJournal").addEventListener("click", () => document.getElementById("filterOverlay").style.display = "flex");
    document.getElementById("btnCancelFilter").addEventListener("click", () => document.getElementById("filterOverlay").style.display = "none");
    document.getElementById("btnApplyFilter").addEventListener("click", async () => { /*...*/ });
    document.getElementById("closeJournal").addEventListener("click", ()=>document.getElementById("journalOverlay").style.display="none");
    document.getElementById("btnExportJournal").addEventListener("click", exportJournal);
    document.getElementById('input').addEventListener('keydown', function(event) { /*...*/ });
    document.getElementById('passwordInput').addEventListener('keydown', function(event) { if (event.key === 'Enter') { document.getElementById('btnConfirmClear').click(); }});
    
    // ИСПРАВЛЕНИЕ 3: Обновленные обработчики для очистки с запросом пароля
    document.getElementById("btnClearJournal").addEventListener("click", () => {
        requestPassword(() => {
            const userToClear = displayedJournal.length > 0 ? displayedJournal[0].user : currentUser;
            showConfirm(`Вы уверены, что хотите очистить ВЕСЬ журнал для пользователя ${userToClear}?`, async () => {
                await saveJournal(userToClear, []);
                if(userToClear === currentUser) journal = [];
                displayedJournal = [];
                renderJournal([]);
                showToast("Журнал для " + userToClear + " очищен.");
            });
        });
    });

    document.getElementById('btnClearTrainingList').addEventListener('click', () => {
        requestPassword(() => {
            showConfirm('Вы уверены, что хотите полностью очистить список на тренинг?', async () => {
                await saveTrainingList([], true);
                renderTrainingList();
            });
        });
    });

    document.getElementById('btnClearGuests').addEventListener('click', () => {
        requestPassword(() => {
            showConfirm('Вы уверены, что хотите полностью очистить журнал гостей?', async () => {
                await saveGuestList([]);
                await loadGuestList();
                renderGuestList();
                showToast("Журнал гостей очищен.");
            });
        });
    });
    
    // ... Новые обработчики для "Тренинга" и "Гостей" (кроме очистки) ...
    document.getElementById('btnTraining').addEventListener('click', () => { renderTrainingList(); document.getElementById('trainingOverlay').style.display = 'flex'; });
    document.getElementById('closeTraining').addEventListener('click', () => { document.getElementById('trainingOverlay').style.display = 'none'; });
    document.getElementById('btnUploadTrainingList').addEventListener('click', () => { document.getElementById('uploadTrainingOverlay').style.display = 'flex'; });
    document.getElementById('btnCancelUpload').addEventListener('click', () => { document.getElementById('uploadTrainingOverlay').style.display = 'none'; document.getElementById('trainingListInput').value = ''; });
    document.getElementById('btnSaveTrainingList').addEventListener('click', async () => { /*...*/ });
    document.getElementById('btnGuests').addEventListener('click', () => { renderGuestList(); document.getElementById('guestOverlay').style.display = 'flex'; });
    document.getElementById('closeGuests').addEventListener('click', () => { document.getElementById('guestOverlay').style.display = 'none'; });
    document.getElementById('btnExportGuests').addEventListener('click', exportGuests);

    // Вспомогательные функции (вставил сюда для компактности, они были разбросаны)
    // Эти функции вызываются из разных мест, но их код я не менял, поэтому скрыл
    async function saveTrainingList(newList, isNewUpload = false) { try { const dataToSave = { fio_list: newList }; if (isNewUpload) { dataToSave.initial_size = newList.length; } await firestore.collection("app_data").doc("training").set(dataToSave, { merge: true }); showToast("Список на тренинг обновлен!"); await loadTrainingList(); } catch (error) { console.error(error); showToast("Ошибка.", true); } }
    async function loadTrainingList() { try { const doc = await firestore.collection("app_data").doc("training").get(); if (doc.exists) { trainingList = doc.data().fio_list || []; initialTrainingListSize = doc.data().initial_size || trainingList.length; } else { trainingList = []; initialTrainingListSize = 0; } } catch (error) { console.error(error); } }
    async function loadGuestList() { try { const doc = await firestore.collection("app_data").doc("guests").get(); guestList = doc.exists ? (doc.data().entries || []) : []; } catch (error) { console.error(error); } }
    async function saveGuestList(updatedGuestList) { try { await firestore.collection("app_data").doc("guests").set({ entries: updatedGuestList }); } catch (error) { console.error(error); } }
</script>
</body>
</html>